#!/bin/sh

compiler=$1
branch=`git rev-parse --abbrev-ref HEAD 2>/dev/null`
commit=`git rev-parse --verify --short=12 HEAD 2>/dev/null`
commitcnt=`git rev-list --first-parent --count HEAD 2>/dev/null`
versionstring="$branch-n$commitcnt-$commit"
builddate=`date`
buildhost=`uname -n`
builduser=`whoami`
buildpath=`pwd`
buildsys=`uname`
buildarch=`uname -m`
case "$buildsys" in
	SunOS | NetBSD)
		buildtime=`date -u "+%FT%T+00:00"`
		;;
	*)
		buildtime=`date -u -Iseconds`
		;;
esac
buildstring="es-mveety $compiler $versionstring $builduser@$buildhost:$buildpath $buildsys $buildarch"

echo "/* autogenerated file! do not edit! */"
echo "/* produced by make_version */"
echo "#include \"es.h\""
echo "static const char version1[] = \"$versionstring\";"
echo "static const char buildstring1[] = \"$buildstring\";"
echo "static const char buildtime1[] = \"$buildtime\";"
echo "static const char sccs_id[] = \"@(#) $buildstring\";"
echo "const char * const version = version1;"
echo "const char * const buildstring = buildstring1;"
echo "const char * const buildtime = buildtime1;"
echo "const char * const sccs_id1 = sccs_id;"
echo ""
